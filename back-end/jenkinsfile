pipeline {
    agent any

    tools {
        maven 'Maven' // Jenkins에 설정한 Maven 이름
    }

    environment {
        JAVA_HOME = 'C:\\dev\\java-17-openjdk-17.0.3.0.6-1'
        PATH = "${env.JAVA_HOME}\\bin;${env.PATH}"
    }

    triggers {
        pollSCM('H/6 * * * 1-5')
    }

    stages {
        stage('clone repository') {
            steps {
                git branch: 'main', credentialsId: 'github-token', url: 'https://github.com/YeongKing/test_jenkins2.git'
            }
        }
        stage('build WAR') {
            steps {
                script {
                    def mvnHome = tool name: 'Maven', type: 'hudson.tasks.Maven$MavenInstallation'
                    withEnv(["MAVEN_HOME=${mvnHome}"]) {
                        //pom.xml에 version노드의 war가 targit 디렉토리에 생성된다.
                        bat "\"${mvnHome}\\bin\\mvn\" clean package -DskipTests"
                    }
                }
            }
        }
    }
}